<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Visi贸n Remota | Sistema de Vigilancia</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
</head>
<body>
    <!-- Fondo futurista -->
    <div class="background">
        <div class="grid-lines"></div>
        <div class="particles"></div>
        <div class="glow-effect"></div>
    </div>

    <!-- Contenedor principal -->
    <div class="container">
        <!-- Encabezado -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-satellite-dish"></i>
                <h1>Visi贸n<span>Remota</span></h1>
                <div class="status-dot connected"></div>
            </div>
            <div class="connection-info">
                <span id="connectionStatus" class="status"> Conectado</span>
            </div>
        </header>

        <!-- Pantalla de selecci贸n de modo -->
        <main id="modeSelection" class="main-content">
            <div class="intro-card">
                <div class="pulse-ring"></div>
                <h2><i class="fas fa-broadcast-tower"></i> Sistema de Vigilancia WebRTC</h2>
                <p class="subtitle">Conecta dispositivos en tiempo real con transmisi贸n de audio y video</p>
            </div>

            <div class="mode-cards">
                <div class="mode-card emitter">
                    <div class="mode-icon">
                        <i class="fas fa-video"></i>
                        <div class="holographic-effect"></div>
                    </div>
                    <h3>Modo Emisor</h3>
                    <p class="mode-description">
                        Comparte tu c谩mara y micr贸fono. Genera un c贸digo para que otros se conecten a tu transmisi贸n en vivo.
                    </p>
                    <div class="features">
                        <span><i class="fas fa-camera"></i> C谩mara HD</span>
                        <span><i class="fas fa-microphone"></i> Audio en vivo</span>
                        <span><i class="fas fa-shield-alt"></i> C贸digo seguro</span>
                    </div>
                    <button id="btnEmitter" class="glow-button">
                        <i class="fas fa-play-circle"></i> Activar como Emisor
                    </button>
                </div>

                <div class="mode-card viewer">
                    <div class="mode-icon">
                        <i class="fas fa-eye"></i>
                        <div class="holographic-effect"></div>
                    </div>
                    <h3>Modo Supervisor</h3>
                    <p class="mode-description">
                        Con茅ctate a una transmisi贸n en vivo usando el c贸digo del emisor. Visualiza y comun铆cate en tiempo real.
                    </p>
                    <div class="features">
                        <span><i class="fas fa-desktop"></i> Visualizaci贸n</span>
                        <span><i class="fas fa-comment-alt"></i> Comunicaci贸n</span>
                        <span><i class="fas fa-expand"></i> Pantalla completa</span>
                    </div>
                    <button id="btnViewer" class="glow-button">
                        <i class="fas fa-plug"></i> Conectar como Supervisor
                    </button>
                </div>
            </div>

            <div class="instructions">
                <h4><i class="fas fa-info-circle"></i> Instrucciones R谩pidas</h4>
                <ol>
                    <li>El <strong>Emisor</strong> genera un c贸digo y comparte su c谩mara</li>
                    <li>El <strong>Supervisor</strong> introduce ese c贸digo para ver la transmisi贸n</li>
                    <li>La conexi贸n es <strong>directa</strong> entre dispositivos (P2P)</li>
                    <li>Comunicaci贸n de <strong>audio bidireccional</strong> disponible</li>
                </ol>
            </div>
        </main>

        <!-- Panel del Emisor -->
        <div id="emitterPanel" class="panel hidden">
            <div class="panel-header">
                <button class="back-button" id="backFromEmitter">
                    <i class="fas fa-arrow-left"></i> Volver
                </button>
                <h2><i class="fas fa-video"></i> Panel del Emisor</h2>
                <div class="status-badge streaming" id="emitterStatusBadge">
                    <i class="fas fa-circle"></i> Listo
                </div>
            </div>

            <div class="panel-content">
                <div class="video-section">
                    <div class="video-container">
                        <video id="localVideo" autoplay muted playsinline></video>
                        <div class="video-overlay">
                            <div class="video-info">
                                <span class="camera-status"><i class="fas fa-circle"></i> CMARA LOCAL</span>
                                <span class="quality-tag" id="qualityTag">HD</span>
                            </div>
                        </div>
                        <div class="video-controls">
                            <button id="btnSwitchCamera" class="control-button" title="Cambiar c谩mara">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <button id="btnFlipCamera" class="control-button" title="Espejo horizontal">
                                <i class="fas fa-exchange-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="code-section">
                    <div class="section-title">
                        <i class="fas fa-key"></i> C贸digo de Acceso
                    </div>
                    <div class="code-display">
                        <div class="code-value" id="emitterCode">GENERANDO...</div>
                        <div class="code-actions">
                            <button id="btnCopyCode" class="action-button">
                                <i class="far fa-copy"></i> Copiar
                            </button>
                            <button id="btnRefreshCode" class="action-button">
                                <i class="fas fa-redo"></i> Nuevo C贸digo
                            </button>
                        </div>
                    </div>
                    <p class="hint">
                        <i class="fas fa-share-alt"></i> Comparte este c贸digo con quien quieras que vea tu transmisi贸n
                    </p>
                </div>

                <div class="controls-section">
                    <div class="section-title">
                        <i class="fas fa-sliders-h"></i> Controles
                    </div>
                    <div class="control-buttons">
                        <button id="btnStartEmitter" class="primary-button">
                            <i class="fas fa-play"></i> Iniciar Transmisi贸n
                        </button>
                        <button id="btnStopEmitter" class="danger-button hidden">
                            <i class="fas fa-stop"></i> Detener Transmisi贸n
                        </button>
                        <button id="btnAudioToggle" class="secondary-button">
                            <i class="fas fa-microphone"></i> Micr贸fono: ON
                        </button>
                    </div>

                    <div class="settings">
                        <div class="setting">
                            <label for="videoQuality">
                                <i class="fas fa-hd"></i> Calidad de Video
                            </label>
                            <select id="videoQuality">
                                <option value="low">Baja (480p)</option>
                                <option value="medium" selected>Media (720p)</option>
                                <option value="high">Alta (1080p)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="connected-clients">
                    <div class="section-title">
                        <i class="fas fa-users"></i> Supervisores Conectados
                    </div>
                    <div id="connectedClients" class="clients-list">
                        <div class="empty-state">
                            <i class="fas fa-user-clock"></i>
                            <p>Esperando conexiones...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel del Supervisor -->
        <div id="viewerPanel" class="panel hidden">
            <div class="panel-header">
                <button class="back-button" id="backFromViewer">
                    <i class="fas fa-arrow-left"></i> Volver
                </button>
                <h2><i class="fas fa-eye"></i> Panel del Supervisor</h2>
                <div class="status-badge disconnected" id="viewerStatusBadge">
                    <i class="fas fa-circle"></i> Desconectado
                </div>
            </div>

            <div class="panel-content">
                <div class="connection-section">
                    <div class="section-title">
                        <i class="fas fa-link"></i> Conectar a Emisor
                    </div>
                    <div class="connection-input">
                        <div class="input-group">
                            <div class="input-icon">
                                <i class="fas fa-key"></i>
                            </div>
                            <input type="text" 
                                   id="peerCodeInput" 
                                   placeholder="Ingresa el c贸digo del emisor (ej: A1B2C3)"
                                   autocomplete="off"
                                   maxlength="6">
                            <button id="btnConnect" class="connect-button">
                                <i class="fas fa-plug"></i> Conectar
                            </button>
                        </div>
                        <div class="recent-codes" id="recentCodes">
                            <!-- C贸digos recientes aparecer谩n aqu铆 -->
                        </div>
                    </div>
                </div>

                <div class="video-section">
                    <div class="video-container">
                        <video id="remoteVideo" autoplay playsinline></video>
                        <div class="video-overlay" id="connectionOverlay">
                            <div class="connection-prompt">
                                <i class="fas fa-satellite"></i>
                                <h3>ESPERANDO CONEXIN</h3>
                                <p>Introduce un c贸digo para ver la transmisi贸n en vivo</p>
                            </div>
                        </div>
                        <div class="video-controls">
                            <button id="btnFullscreen" class="control-button" title="Pantalla completa">
                                <i class="fas fa-expand"></i>
                            </button>
                            <button id="btnTakeSnapshot" class="control-button" title="Capturar pantalla">
                                <i class="fas fa-camera"></i>
                            </button>
                            <button id="btnMuteAudio" class="control-button" title="Silenciar audio">
                                <i class="fas fa-volume-up"></i>
                            </button>
                        </div>
                        <div class="video-stats">
                            <div class="stat">
                                <i class="fas fa-signal"></i>
                                <span id="connectionStats">--</span>
                            </div>
                            <div class="stat">
                                <i class="fas fa-clock"></i>
                                <span id="uptime">00:00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="communication-section">
                    <div class="section-title">
                        <i class="fas fa-microphone"></i> Comunicaci贸n
                    </div>
                    <div class="communication-controls">
                        <button id="btnStartAudio" class="audio-button disabled">
                            <i class="fas fa-microphone-slash"></i>
                            <span>Activar Micr贸fono</span>
                            <div class="pulse-indicator"></div>
                        </button>
                        <button id="btnStopAudio" class="audio-button danger hidden">
                            <i class="fas fa-microphone"></i>
                            <span>Desactivar Micr贸fono</span>
                        </button>
                        <button id="btnTestAudio" class="test-button">
                            <i class="fas fa-volume-up"></i> Probar Audio
                        </button>
                    </div>
                    <div class="volume-control">
                        <label><i class="fas fa-volume-up"></i> Volumen</label>
                        <input type="range" id="remoteVolume" min="0" max="100" value="80">
                    </div>
                </div>

                <div class="connection-status">
                    <div class="section-title">
                        <i class="fas fa-info-circle"></i> Estado de Conexi贸n
                    </div>
                    <div id="connectionDetails" class="status-details">
                        <div class="detail">
                            <span class="label">Estado:</span>
                            <span class="value" id="connectionState">Desconectado</span>
                        </div>
                        <div class="detail">
                            <span class="label">Latencia:</span>
                            <span class="value" id="latencyValue">-- ms</span>
                        </div>
                        <div class="detail">
                            <span class="label">Protocolo:</span>
                            <span class="value">WebRTC P2P</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notificaciones -->
    <div id="notificationContainer"></div>

    <!-- Modal de Error -->
    <div id="errorModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle"></i> Error de Conexi贸n</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p id="errorMessage">No se pudo establecer la conexi贸n. Verifica el c贸digo e intenta nuevamente.</p>
                <div class="modal-actions">
                    <button id="btnRetry" class="primary-button">Reintentar</button>
                    <button class="secondary-button close-modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
